
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Acceso - Laboratorio de Anatomía Patológica</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}:root{--primary:#2c497e;--secondary:#3a6ea5;--accent:#4b8fcc;--light:#f0f7ff;--dark:#1a2a4a;--gray:#6c757d;--error:#dc3545;--success:#28a745}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}body{background:linear-gradient(135deg,#e6f0ff,#f8fbff);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:10px}.container{background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.15);width:100%;max-width:950px;display:flex;overflow:hidden;animation:fadeIn .4s}.left-panel{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:40px 30px;display:flex;flex-direction:column;justify-content:center;flex:1;min-width:280px}.logo{display:flex;align-items:center;margin-bottom:25px;font-size:22px;font-weight:700}.logo i{font-size:32px;margin-right:10px}.welcome-title{font-size:28px;margin-bottom:15px;line-height:1.2}.welcome-text{font-size:16px;opacity:.9;margin-bottom:25px}.feature{display:flex;align-items:center;margin-bottom:15px;font-size:15px}.feature i{margin-right:10px;font-size:20px;color:var(--accent)}.right-panel{padding:40px 25px;display:flex;align-items:center;justify-content:center;flex:1}.login-container{width:100%;max-width:320px}.login-title{font-size:24px;color:var(--dark);margin-bottom:25px;text-align:center}.form-group{position:relative;margin-bottom:20px}.form-control{width:100%;padding:15px 15px 15px 45px;border:1px solid #ccc;border-radius:10px;font-size:16px;outline:none;transition:border .2s}.form-control:focus{border-color:var(--accent)}.input-icon{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:var(--gray)}.password-toggle{position:absolute;right:15px;top:50%;transform:translateY(-50%);cursor:pointer;color:var(--gray)}.login-btn{width:100%;padding:15px;border:none;border-radius:10px;background:linear-gradient(to right,var(--primary),var(--secondary));color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s}.login-btn:hover{box-shadow:0 5px 15px rgba(44,73,126,.3)}.error-message{color:var(--error);text-align:center;margin-top:15px;height:20px}.footer{text-align:center;margin-top:20px;font-size:12px;color:var(--gray)}
    </style>
</head>
<body>
    <!-- LOGIN -->
    <div class="container" id="loginContainer">
        <div class="left-panel">
            <div class="logo"><i class="fas fa-microscope"></i>LAB PATOLÓGICA</div>
            <h1 class="welcome-title">Sistema de Gestión de Diagnósticos</h1>
            <p class="welcome-text">Accede a nuestra plataforma segura para gestionar diagnósticos y colaborar con el equipo médico.</p>
            <div class="feature"><i class="fas fa-shield-alt"></i>Plataforma segura HIPAA</div>
            <div class="feature"><i class="fas fa-file-medical"></i>Historial completo de pacientes</div>
            <div class="feature"><i class="fas fa-sync-alt"></i>Sincronización en tiempo real</div>
        </div>
        <div class="right-panel">
            <div class="login-container">
                <h2 class="login-title">Acceso al Sistema</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" class="form-control" id="username" placeholder="Usuario" required list="username-options">
                        <datalist id="username-options"></datalist>
                    </div>
                    <div class="form-group">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" class="form-control" id="password" placeholder="Contraseña" required>
                        <i class="fas fa-eye password-toggle" id="togglePassword"></i>
                    </div>
                    <button type="submit" class="login-btn">Iniciar Sesión</button>
                    <div class="error-message" id="errorMessage"></div>
                </form>
                <div class="footer">© 2023 Laboratorio de Anatomía Patológica</div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const loginForm = document.getElementById("loginForm");
            const errorMessage = document.getElementById("errorMessage");
            const usernameInput = document.getElementById("username");
            const usernameOptions = document.getElementById("username-options");

            // Cargar usuarios recordados
            const savedUsernames = JSON.parse(localStorage.getItem('savedUsernames')) || [];
            savedUsernames.forEach(username => {
                const option = document.createElement('option');
                option.value = username;
                usernameOptions.appendChild(option);
            });
            if(savedUsernames.length > 0){
                usernameInput.value = savedUsernames[savedUsernames.length -1];
            }

            if (loginForm) {
                loginForm.onsubmit = async (e) => {
                    e.preventDefault();
                    const username = usernameInput.value;
                    const password = document.getElementById("password").value;

                    try {
                        const response = await fetch('http://localhost:3000/api/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ username, password })
                        });

                        const data = await response.json();

                        if (response.ok) {
                            // Guardar el token y los datos del usuario en sessionStorage
                            sessionStorage.setItem('token', data.token);
                            sessionStorage.setItem('currentUser', JSON.stringify(data.user));

                            // Guardar usuario en localStorage para autocompletado
                            let usernames = JSON.parse(localStorage.getItem('savedUsernames')) || [];
                            if (!usernames.includes(username)) {
                                usernames.push(username);
                                localStorage.setItem('savedUsernames', JSON.stringify(usernames));
                            }
                            
                            // Redirigir a la página principal
                            window.location.href = "pagina2.html";
                        } else {
                            errorMessage.textContent = data.error || "Error al iniciar sesión.";
                        }
                    } catch (error) {
                        console.error('Error de conexión:', error);
                        errorMessage.textContent = "No se pudo conectar con el servidor.";
                    }
                };
            }

            const togglePassword = document.getElementById("togglePassword");
            if (togglePassword) {
                togglePassword.onclick = () => {
                    const passwordInput = document.getElementById("password");
                    if (passwordInput) {
                        passwordInput.type = passwordInput.type === "password" ? "text" : "password";
                        togglePassword.classList.toggle('fa-eye');
                        togglePassword.classList.toggle('fa-eye-slash');
                    }
                };
            }
        });
    </script>
</body>
</html>
